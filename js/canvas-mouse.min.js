/*
	canvas-mouse 0.8.0-alpha
	Copyright (c) 2017 Epistemex
	MIT license.
*/
"use strict";function CanvasMouse(j,u){if(!(j instanceof CanvasRenderingContext2D)){throw"Need a 2D canvas context."}u=Object.assign({handleScale:!1,handleTransforms:!1,handleResize:!0,handleScroll:!0,onchange:null,matrix:null,plugins:[]},u);var t=this,k=Object.defineProperty.bind(Object),z,p=("currentTransform" in j||"mozCurrentTransform" in j),y=u.plugins,l,m,A,B,v,w,i=j.canvas,s=u.matrix,q=s?s.inverse():null,n=u.handleScale,o=u.handleTransforms&&(p||s),C=s?f:e;if(o&&!p&&!s){console.log("currentTransform not supported by browser");o=!1}function x(){if(s&&!s._xx){s._xx=s._x;s._x=function(){q=this.inverse();return this._xx()}}}function r(){var N=i.getBoundingClientRect(),H=getComputedStyle(i),K=H.getPropertyValue.bind(H),J=parseFloat,E="padding-",D="border-",F="-width",I="left",M="right",O="top",G="bottom";v=J(K(E+I))+J(K(D+I+F));w=J(K(E+O))+J(K(D+O+F));l=N.left+v;m=N.top+w;A=(i.width/(N.width-(v+J(K(E+M))+J(K(D+M+F)))))||1;B=(i.height/(N.height-(w+J(K(E+G))+J(K(D+G+F)))))||1}function b(){cancelAnimationFrame(z);z=requestAnimationFrame(g)}function c(){cancelAnimationFrame(z);z=requestAnimationFrame(h)}function g(){r();if(u.onchange){u.onchange({type:"resize",timeStamp:Date.now()})}}function h(){var D=i.getBoundingClientRect();l=D.left+v;m=D.top+w;if(u.onchange){u.onchange({type:"scroll",timeStamp:Date.now()})}}function a(D){return{x:D.clientX-l,y:D.clientY-m,timeStamp:D.timeStamp}}function d(D){D.x*=A;D.y*=B;return D}function e(G){var D=(j.currentTransform||j.mozCurrentTransform),F,E;if(D instanceof SVGMatrix){D=DOMMatrix.fromMatrix(D)}F=typeof D.a==="undefined"?new DOMMatrix(D):D;E=F.invertSelf();return{x:G.x*E.a+G.y*E.c+E.e,y:G.x*E.b+G.y*E.d+E.f,timeStamp:G.timeStamp}}function f(E){var D=q.applyToPoint(E.x,E.y);return{x:D.x,y:D.y,timeStamp:E.timeStamp}}this.getPos=function(D){var F=a(D);if(n){F=d(F)}if(o){F=C(F)}if(y.length){for(var E=0;E<y.length;E++){F=y[E].handler(D,F)}}return F};this.getPosXY=function(E,F){var D;if(arguments.length===1){F=E.y;D=E.x}else{D=E}return t.getPos({clientX:D/A+l,clientY:F/B+m,timestamp:Date.now()})};this.addPlugin=function(D){if(y.indexOf(D)<0){y.push(D)}};this.removePlugin=function(E){var D=y.indexOf(E);if(D>-1){y.splice(D,1)}};this.init=r;this.update=h;k(t,"handleScale",{get:function(){return n},set:function(D){n=!!D}});k(t,"handleTransforms",{get:function(){return o},set:function(D){o=!!D&&(p||s)}});k(t,"handleScroll",{get:function(){return u.handleScroll},set:function(D){if(D){window.addEventListener("scroll",c);u.handleScroll=!0}else{window.removeEventListener("scroll",c);u.handleScroll=!1}}});k(t,"handleResize",{get:function(){return u.handleResize},set:function(D){if(D){window.addEventListener("resize",b);u.handleResize=!0}else{window.removeEventListener("resize",b);u.handleResize=!1}}});k(t,"onchange",{get:function(){return u.onchange},set:function(D){u.onchange=D}});k(t,"matrix",{get:function(){return s},set:function(D){s=D;o=o&&(p||s);x()}});x();r();t.handleResize=u.handleResize;t.handleScroll=u.handleScroll};